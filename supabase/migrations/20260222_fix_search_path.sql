-- ============================================================================
-- ğŸ›¡ï¸ search_path ê³ ì • ë³´ì•ˆ íŒ¨ì¹˜ (2026-02-22)
-- Supabase Linter ê²½ê³ : function_search_path_mutable í•´ê²°
-- 
-- ë¬¸ì œ: SECURITY DEFINER í•¨ìˆ˜ì—ì„œ search_pathê°€ ê³ ì •ë˜ì§€ ì•Šìœ¼ë©´,
--        ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆì— ê°™ì€ ì´ë¦„ì˜ í…Œì´ë¸”/í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´
--        í•¨ìˆ˜ ì‹¤í–‰ ì‹œ ê°€ë¡œì±„ê¸° ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
-- 
-- í•´ê²°: ëª¨ë“  SECURITY DEFINER í•¨ìˆ˜ì— SET search_path = '' ì¶”ê°€
--        â†’ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ë°˜ë“œì‹œ public.í…Œì´ë¸”ëª… ìœ¼ë¡œ ì°¸ì¡°í•˜ê²Œ ê°•ì œ
-- ============================================================================

-- ==========================================================================
-- 1. is_admin() â€” ê°€ì¥ ìœ„í—˜ (ëª¨ë“  RLS ì •ì±…ì˜ ê¸°ë°˜)
-- ==========================================================================
ALTER FUNCTION public.is_admin() SET search_path = '';

-- ==========================================================================
-- 2. increment_student_points â€” í¬ì¸íŠ¸ ì¦ê°€ RPC
-- ==========================================================================
ALTER FUNCTION public.increment_student_points(UUID, INTEGER, TEXT, UUID, UUID) SET search_path = '';

-- ==========================================================================
-- 3. teacher_manage_points â€” êµì‚¬ í¬ì¸íŠ¸ ê´€ë¦¬ RPC
-- ==========================================================================
ALTER FUNCTION public.teacher_manage_points(UUID, INTEGER, TEXT) SET search_path = '';

-- ==========================================================================
-- 4. add_student_with_bonus â€” í•™ìƒ ë“±ë¡ + ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸ RPC
-- ==========================================================================
ALTER FUNCTION public.add_student_with_bonus(UUID, TEXT, TEXT, INTEGER) SET search_path = '';

-- ==========================================================================
-- 5. mark_feedback_as_read â€” í”¼ë“œë°± ì½ìŒ ì²˜ë¦¬ RPC
-- ==========================================================================
ALTER FUNCTION public.mark_feedback_as_read(UUID) SET search_path = '';

-- ==========================================================================
-- 6. update_tower_max_floor â€” ë³´ìº¡íƒ€ì›Œ ìµœê³ ì¸µ ì—…ë°ì´íŠ¸ RPC
-- ==========================================================================
ALTER FUNCTION public.update_tower_max_floor(UUID, UUID, INTEGER) SET search_path = '';

-- ==========================================================================
-- 7. spend_student_points â€” í¬ì¸íŠ¸ ì°¨ê° RPC
-- ==========================================================================
ALTER FUNCTION public.spend_student_points(INTEGER, TEXT, JSONB) SET search_path = '';

-- ==========================================================================
-- 8. bind_student_auth â€” í•™ìƒ ì¸ì¦ ë°”ì¸ë”© RPC
-- ==========================================================================
ALTER FUNCTION public.bind_student_auth(TEXT) SET search_path = '';

-- ==========================================================================
-- 9. unbind_student_auth â€” í•™ìƒ ì¸ì¦ í•´ì œ RPC
-- ==========================================================================
ALTER FUNCTION public.unbind_student_auth() SET search_path = '';

-- ==========================================================================
-- 10. get_student_by_auth â€” í•™ìƒ ì¸ì¦ ì¡°íšŒ RPC
-- ==========================================================================
ALTER FUNCTION public.get_student_by_auth() SET search_path = '';

-- ==========================================================================
-- 11. setup_teacher_profile â€” êµì‚¬ í”„ë¡œí•„ ì´ˆê¸° ì„¤ì • RPC
-- ==========================================================================
ALTER FUNCTION public.setup_teacher_profile(TEXT, TEXT, TEXT) SET search_path = '';

-- ==========================================================================
-- 12. protect_profile_sensitive_columns â€” í”„ë¡œí•„ ë³´ì•ˆ íŠ¸ë¦¬ê±° í•¨ìˆ˜
-- ==========================================================================
ALTER FUNCTION public.protect_profile_sensitive_columns() SET search_path = '';

-- ==========================================================================
-- 13. handle_email_verification â€” ì´ë©”ì¼ ì¸ì¦ ì²˜ë¦¬ íŠ¸ë¦¬ê±° í•¨ìˆ˜
-- ==========================================================================
ALTER FUNCTION public.handle_email_verification() SET search_path = '';

-- ==========================================================================
-- 14. cleanup_expired_deletions â€” ë§Œë£Œëœ ì‚­ì œ ì •ë¦¬ í•¨ìˆ˜
-- ==========================================================================
ALTER FUNCTION public.cleanup_expired_deletions() SET search_path = '';

-- ==========================================================================
-- 15. get_my_class_id â€” ë‚´ í•™ê¸‰ ID ì¡°íšŒ RPC
-- ==========================================================================
ALTER FUNCTION public.get_my_class_id() SET search_path = '';
